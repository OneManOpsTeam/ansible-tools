#!/usr/bin/env bash
#
# Author:   Bert Van Vreckem <bert.vanvreckem@gmail.com>
#
# Initialise an Ansible project, based on
# https://github.com/bertvv/ansible-skeleton/

set -u # abort on unbound variable

debug_mode=false
verbose_mode=false

usage() {
cat << EOF
Usage: ${0##*/} [-h] [ROLE_NAME]

Create the Ansible role scaffolding

Options:
    -h          show this help message and exit
    -v          verbose mode
EOF
}

OPTIND=1 # Reset is necessary if getopts was used previously in the script.  It is a good idea to make this local in a function.
while getopts "hvd" opt; do
    case "$opt" in
        h)
            usage
            exit 0
            ;;
        d)
            debug_mode=true
            ;;
        v)
            verbose_mode=true
            ;;
        '?')
            usage >&2
            exit 1
            ;;
    esac
done
shift "$((OPTIND-1))"

if [ "$#" -lt "1" ]; then
    usage
    exit 2
fi

if $debug_mode; then
  set -x
fi


project="$1"

if [ -d "${project}" ]; then
  echo "Project directory ${project} already exists. Bailing out." >&2
  exit 1
fi

wget https://github.com/bertvv/ansible-skeleton/archive/master.zip
unzip master.zip
rm master.zip

mv ansible-skeleton-master "${project}"
git init "${project}"
cd "${project}" || exit
git add .
git commit --message "Initial commit"
